# M05 DevOps用户权限管理系统

## 🎯 用户角色权限管理基本常识

### 1. 权限管理概述

#### 1.1 什么是权限管理？
权限管理是控制用户在系统中能够执行哪些操作的安全机制。它的核心目标是：
- **安全性**：防止未授权访问敏感数据和功能
- **合规性**：满足企业内控制度和法规要求
- **可控性**：精确控制用户的操作范围和数据访问权限

#### 1.2 为什么需要权限管理？
在企业级系统中，不同用户需要不同的访问权限：
- **数据安全**：防止数据泄露、误删、恶意篡改
- **职责分工**：不同岗位有不同的操作权限
- **审计追踪**：记录谁在什么时候做了什么操作
- **风险控制**：降低内部人员违规操作的风险

### 2. RBAC权限模型详解

#### 2.1 RBAC模型核心概念

**RBAC（Role-Based Access Control）** 是目前最主流的权限管理模型：

```
用户(User) → 角色(Role) → 权限(Permission) → 资源(Resource)
```

**四大核心要素：**

| 要素 | 定义 | 举例 |
|------|------|------|
| **用户(User)** | 系统的使用者 | 张三、李四、王五 |
| **角色(Role)** | 职能或岗位的抽象 | 管理员、编辑者、查看者 |
| **权限(Permission)** | 对资源的具体操作 | 创建、读取、更新、删除 |
| **资源(Resource)** | 被操作的对象 | 用户信息、文章、订单、报表 |

#### 2.2 RBAC模型的优势

**相比传统的用户-权限直接关联模式，RBAC有以下优势：**

1. **简化权限分配**
   - 传统方式：给每个用户逐个分配权限（复杂）
   - RBAC方式：给用户分配角色，角色包含权限（简单）

2. **便于权限管理**
   - 角色权限变更时，所有该角色的用户权限自动更新
   - 新员工入职时，只需分配对应角色即可

3. **符合组织架构**
   - 角色对应实际的职位和岗位
   - 便于理解和管理

#### 2.3 RBAC的标准模型

**RBAC0（基础模型）**
- 用户-角色-权限的基本关联
- 一个用户可以有多个角色
- 一个角色可以有多个权限

**RBAC1（角色层次模型）**
- 在RBAC0基础上增加角色继承
- 上级角色自动拥有下级角色的所有权限
- 形成角色层次结构


### 3. 权限设计的基本原则

#### 3.1 最小权限原则（Principle of Least Privilege）
- **定义**：用户只获得完成其工作职责所需的最小权限
- **目的**：降低安全风险，减少误操作可能性
- **实践**：
  - 新用户默认最小权限
  - 定期审查和回收不必要的权限
  - 临时权限要有明确的到期时间

#### 3.2 职责分离原则（Separation of Duties）
- **定义**：关键业务操作需要多人协作完成
- **目的**：防止单人拥有过大权限，降低内部风险
- **实践**：
  - 财务审批需要申请人、审核人、批准人
  - 系统管理员不能同时拥有开发和生产环境权限
  - 数据备份和恢复由不同人员负责

#### 3.3 权限继承原则
- **定义**：上级角色自动拥有下级角色的所有权限
- **目的**：简化权限管理，符合组织层级
- **实践**：
  - 部门经理拥有部门员工的所有权限
  - 系统管理员拥有普通用户的所有权限

### 4. 本系统的5级权限体系

#### 4.1 权限层级结构

```
超级管理员 (Super Admin)
    ├── 系统管理员 (System Admin)
    │   ├── 团队负责人 (Team Leader)
    │   │   ├── 团队管理员 (Team Admin)
    │   │   │   └── 普通用户 (User)
```

#### 4.2 各角色详细权限

| 角色 | 权限范围 | 核心职责 | 典型操作 |
|------|----------|----------|----------|
| **超级管理员** | 全系统 | 系统架构和安全 | 系统配置、备份恢复、安全策略 |
| **系统管理员** | 全系统用户 | 用户和权限管理 | 用户增删改查、角色分配、权限审计 |
| **团队负责人** | 所属团队 | 团队业务管理 | 团队成员管理、业务数据管理 |
| **团队管理员** | 团队部分功能 | 日常运营管理 | 数据录入、报表查看、流程审批 |
| **普通用户** | 个人数据 | 基础业务操作 | 查看个人信息、提交申请、修改密码 |

#### 4.3 权限继承关系

```
超级管理员权限 = 系统管理员权限 + 系统配置权限
系统管理员权限 = 团队负责人权限 + 全局用户管理权限
团队负责人权限 = 团队管理员权限 + 团队人员管理权限
团队管理员权限 = 普通用户权限 + 团队数据管理权限
```

### 5. 权限控制的两个维度

#### 5.1 功能权限（What - 能做什么）
控制用户能够执行哪些功能操作：

**CRUD权限分类：**
- **Create（创建）**：新增用户、创建订单、发布文章
- **Read（读取）**：查看用户列表、查询订单、浏览文章
- **Update（更新）**：修改用户信息、更新订单状态、编辑文章
- **Delete（删除）**：删除用户、取消订单、删除文章

**业务功能权限：**
- 审批权限：能否审批请假、报销、采购申请
- 配置权限：能否修改系统参数、业务规则
- 导出权限：能否导出敏感数据、财务报表

#### 5.2 数据权限（Which - 能操作哪些数据）
控制用户能够访问和操作哪些具体数据：

**数据范围控制：**
- **全部数据**：超级管理员可以看到所有数据
- **部门数据**：部门经理只能看到本部门的数据
- **团队数据**：团队负责人只能看到本团队的数据
- **个人数据**：普通用户只能看到自己的数据

**数据过滤实现：**
```sql
-- 普通用户查询（只能看自己的数据）
SELECT * FROM orders WHERE user_id = #{currentUserId}

-- 团队管理员查询（只能看本团队的数据）
SELECT * FROM orders WHERE team_id = #{currentUserTeamId}

-- 系统管理员查询（可以看所有数据）
SELECT * FROM orders
```

### 6. 权限实现的技术层面

#### 6.1 前端权限控制
**目的：提升用户体验，减少无效请求**

- **菜单控制**：根据用户权限显示/隐藏菜单项
- **按钮控制**：根据权限启用/禁用操作按钮
- **页面控制**：无权限时跳转到403页面
- **字段控制**：敏感字段根据权限显示/隐藏

```javascript
// 前端权限控制示例
if (hasPermission('user:create')) {
    showCreateButton();
} else {
    hideCreateButton();
}
```

#### 6.2 后端权限控制
**目的：真正的安全控制，防止绕过攻击**

- **接口权限**：每个API接口都要验证用户权限
- **数据权限**：查询时自动过滤用户无权访问的数据
- **业务权限**：在业务逻辑中检查操作权限

```java
// 后端权限控制示例
@PreAuthorize("hasPermission('user:create')")
public Result createUser(User user) {
    // 业务逻辑
}
```

#### 6.3 权限验证流程

```
1. 用户登录 → 2. 生成JWT Token → 3. 前端携带Token请求
     ↓
4. 后端验证Token → 5. 解析用户信息 → 6. 检查接口权限
     ↓
7. 执行业务逻辑 → 8. 应用数据权限过滤 → 9. 返回结果
```


## 🚀 实验步骤

### 第1步：环境准备
```bash
# 1. 启动数据库
cd M05/sql
mysql -u devops2025 -p devops2025 < init.sql

# 2. 启动后端
cd M05/api-springboot
mvn spring-boot:run

# 3. 测试接口
cd M05/tests
python run_all_tests.py
```

### 第2步：核心功能实现
1. **用户认证**：注册、登录、JWT生成
2. **用户管理**：增删改查、角色分配
3. **权限控制**：接口权限验证、数据权限过滤

### 第3步：测试验证
- 单元测试：Service层业务逻辑
- 接口测试：API功能验证
- 集成测试：完整流程测试

---

## 📚 文档目录

本项目包含以下技术文档：

| 文档 | 描述 | 主要内容 |
|------|------|----------|
| [01_需求分析.md](./01_需求分析.md) | 系统需求分析 | 功能需求、非功能需求、用例分析 |
| [02_数据库设计.md](./02_数据库设计.md) | 数据库设计文档 | 表结构设计、字段说明、关系图 |
| [03_API接口设计.md](./03_API接口设计.md) | API接口文档 | 接口规范、请求响应格式、权限说明 |
| [04_系统参考实现.md](./04_系统参考实现.md) | 系统实现指南 | 技术架构、代码结构、实现细节 |
| [05_JWT认证机制.md](./05_JWT认证机制.md) | JWT认证详解 | Token原理、JWT结构、认证流程 |
| [06_HTTP协议基础.md](./06_HTTP协议基础.md) | HTTP协议基础 | HTTP原理、请求响应、状态码、Cookie |

### 📖 阅读建议

**新手学习路径：**
1. 先阅读 `README.md`（本文档）了解权限管理基础概念
2. 查看 `01_需求分析.md` 理解系统功能需求
3. 学习 `06_HTTP协议基础.md` 掌握HTTP基础知识
4. 学习 `05_JWT认证机制.md` 掌握认证原理
5. 参考 `02_数据库设计.md` 了解数据结构
6. 使用 `03_API接口设计.md` 进行接口调用
7. 最后查看 `04_系统参考实现.md` 学习具体实现

**开发者快速上手：**
- 直接查看 `03_API接口设计.md` 了解接口规范
- 参考 `04_系统参考实现.md` 进行代码开发
- 使用 `02_数据库设计.md` 创建数据库表结构
